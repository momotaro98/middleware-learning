---
marp: true
---

# Chapter 9 一貫性と合意

トランザクションがアプリケーションに対してAID(ACIDのCが無い)を提供しシステムの問題を無いように振る舞う抽象化であるように、
8章での分散システムの問題(※)をアプリケーションにとって抽象化したものの概念の1つが**合意(consensus)**である。

> ※: すなわちパケットはロストし、順序は狂い、複製され、ネットワークでどれだけの遅延が生じるかわかりません。クロックはせいぜい大まかにしか正しくありません。ノードは(たとえばGCのため)いつクラッシュしたりするか分かりません。

-----

## 9.1 一貫性の保証

結果整合性(eventual consistency)は正しいデータ状態へと収束するので**収束性(convergence)**の方が適切な名前かもしれない。

結果整合性は**弱い**保証であり、レプリカが**いつ**収束するのかについては何も語らない。

弱い一貫性と強い一貫性の関係は、トランザクション分離レベルの強さに類似点がある。(強さを上げるとパフォーマンスに影響するところ)

ただし、それぞれ注目していることが独立している。トランザクション分離の主眼は、並行してトランザクションの実行することから生じるレース条件を避けることにあるのに対し、分散の一貫性が主眼とするのは遅延やフォールトに際してレプリカの状態を調整することにある。

強い一貫性の代表が**線形化可能性**である。

-----

## 9.2 線形化可能性

レプリケーションが複数台あるときに一度どこかのレプリケーションから最新が返されたらそれ以降はどのレプリケーションはその最新よりも古い値を返さない保証が、**線形化可能性(linearizability)**である。
→ **最新性の保証(recency guarantee)**

線形化可能性は、原子的一貫性、強い一貫性、即時一貫性、外部一貫性、と呼ばれることもある。

-----

TODO: 図9-4

それぞれの四角い棒はクライアントが発行したリクエストであり、棒の開始点はリクエストが送信された時刻、そして棒の終末点はクライアントがレスポンスを受信した時点である。

-----

