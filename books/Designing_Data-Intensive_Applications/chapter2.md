# Chapter 2

データモデルとクエリ言語

-----

## 2.1 リレーショナルモデルとドキュメントモデル

リレーショナルモデルはコンピューティングの歴史の中で他を圧倒してきた。

- ネットワークモデル
- 階層モデル
- オブジェクトデータベース
- XMLデータベース

注目すべきことに、RDBは非常に汎用性が高いことがわかった。SNS、eコマース、SaaSなど依然としてRDBが使われている。

-----

### 2.1.1 NoSQSの誕生

NoSQLが広まった要因

- きわめて巨大なデータセットや優れた書き込みのスループットを含む、リレーショナルで容易に実現できる以上のスケーラビリティが求められるようになったこと
- リレーショナルモデルではうまくサポートされない特殊なクエリ操作
- リレーショナルなスキーマ制約に対するフラストレーションと、もっと動的で表現力に富むデータモデルに対する欲求

-----

### 2.1.2 オブジェクトとリレーショナルのミスマッチ

オブジェクト指向(eg.Ruby)とSQLデータモデルが一致しない、インピーダンスミスマッチと呼ばれる、問題がある。ActiveRecordなどのORMは差異を完全に隠蔽できない。

ドキュメントであるような履歴書のようなデータ構造はJSONが非常に適している。

JSONでの表現は複数テーブルで構成されるスキーマに比べて、**ローカリティ**に優れている。

---

ローカリティが高い以下のようなJSONでの形式はユーザーIDから属性情報が見える。これは1対多の状態になっていると言う。

```json
{
  "user_id": 251,
  "first_name": "Bill",
  "region_id": "us:91", # IDになっている。多対1につながる。
  "education": [
    {"school_name": "Harvard University", "start": 1973, "end": 1975}
    {"school_name": "Lakeside School, Seattle", "start": null, "end": null}
  ]
}
```

-----

### 2.1.3 多対1と多対多の関係

データを正規化するためには多対1の関係が必要になるが、これはドキュメントモデルにはうまく適合しない。

-----

### 2.1.4 ドキュメントデータベースは歴史を繰り返すのか

歴史の流れ

階層モデル (JSONのようなモデル)

↓

ネットワークモデル と リレーショナルモデル が誕生

---

#### 2.1.4.1 ネットワークモデル

CODASYLモデルとも呼ばれる。

ネットワークモデルは階層モデルを一般化したもので、レコードが複数の親を持つことができる。これによって多対1や多対多の関係がモデル化できる。

ネットワークモデルのレコード間リンクはプログラミングのポインタのようなもの。レコードにアクセスするにはルートのレコードからリンクの連鎖に沿う必要があった。これを**アクセスパス**という。

---

ネットワークモデルではアクセスパスをアプリケーションが把握しておかなくてはいけない。

アクセスパスを変更する際は利用しているアプリケーションをすべて変更する必要がある。

---

#### 2.1.4.2 リレーショナルモデル

リレーショナルモデルではアクセスパスにあたる部分は利用するアプリケーションではなく、DB内のクエリオプティマイザ(実行計画)が代わりに見つけてくれる。

---

#### 2.1.4.3 ドキュメントデータベースとの比較